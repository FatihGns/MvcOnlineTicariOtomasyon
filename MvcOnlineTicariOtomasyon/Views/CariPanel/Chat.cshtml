@{
    ViewBag.Title = "Chat";
    Layout = "~/Views/Shared/_CariLayout.cshtml";
}

<div class="chat-container">
    <ul id="discussion" class="chat-messages"></ul>

    <div class="chat-input">
        <input type="text" id="message" placeholder="Mesajınızı yazın..." />
        <button id="sendmessage">Gönder</button>
        <input type="hidden" id="displayname" />
    </div>
</div>

@section scripts {
<script>
    $(document).ready(function () {
        // Kullanıcı adı
        $('#displayname').val(prompt('Adınızı girin:', 'Anonim'));

        var chat = $.connection.chatHub;

        // Gelen mesajları göster
        chat.client.addNewMessageToPage = function (name, message) {
            var currentUser = $('#displayname').val();
            var msgClass = (name === currentUser) ? 'my-message' : 'other-message';
            $('#discussion').append('<li class="' + msgClass + '"><span class="name">' + name + '</span><p>' + $('<div/>').text(message).html() + '</p></li>');
            $('#discussion').scrollTop($('#discussion')[0].scrollHeight);
        };

        // SignalR başlat
        $.connection.hub.start().done(function () {
            $('#sendmessage').click(function () {
                var msg = $('#message').val();
                if (msg.trim() === '') return;
                chat.server.send($('#displayname').val(), msg);
                $('#message').val('').focus();
            });

            // Enter ile gönder
            $('#message').keypress(function (e) {
                if (e.which == 13) $('#sendmessage').click();
            });
        });
    });
</script>

<style>
    .chat-container {
        width: 100%;
        max-width: 600px;
        margin: 20px auto;
        border: 1px solid #ccc;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        height: 500px;
    }

    .chat-messages {
        flex: 1;
        list-style: none;
        padding: 10px;
        overflow-y: auto;
        margin: 0;
    }

        .chat-messages li {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            max-width: 70%;
        }

            .chat-messages li.other-message {
                align-self: flex-start;
                background: #e5e5ea;
                border-radius: 10px 10px 10px 0;
                padding: 5px 10px;
            }

            .chat-messages li.my-message {
                align-self: flex-end;
                background: #0b93f6;
                color: white;
                border-radius: 10px 10px 0 10px;
                padding: 5px 10px;
            }

            .chat-messages li .name {
                font-weight: bold;
                font-size: 0.85em;
                margin-bottom: 2px;
            }

    .chat-input {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ccc;
    }

        .chat-input input[type="text"] {
            flex: 1;
            padding: 8px;
            border-radius: 20px;
            border: 1px solid #ccc;
            outline: none;
        }

        .chat-input button {
            margin-left: 10px;
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background-color: #0b93f6;
            color: white;
            cursor: pointer;
        }

            .chat-input button:hover {
                background-color: #0077cc;
            }
</style>
}
